"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.AllplacesType = void 0;

var _graphql = require("graphql");

var _pg = require("pg");

const conString = 'postgres://postgres:@192.168.20.78/forest_bd';
const pool = new _pg.Pool({
  connectionString: conString
});
const oblast_list = new _graphql.GraphQLObjectType({
  name: "oblast_list",
  fields: () => ({
    oblast_id: {
      type: _graphql.GraphQLString
    },
    oblast_ru: {
      type: _graphql.GraphQLString
    },
    oblast_ky: {
      type: _graphql.GraphQLString
    },
    oblast_en: {
      type: _graphql.GraphQLString
    },
    geom: {
      type: _graphql.GraphQLString
    },
    leshoz_list: {
      type: new _graphql.GraphQLList(leshoz_list),
      resolve: oblast_id => getLeshozList(oblast_id)
    }
  })
});
const leshoz_list = new _graphql.GraphQLObjectType({
  name: "leshoz_list",
  fields: () => ({
    leshoz_id: {
      type: _graphql.GraphQLString
    },
    leshoz_ru: {
      type: _graphql.GraphQLString
    },
    geom: {
      type: _graphql.GraphQLString
    },
    leshoztype_id: {
      type: _graphql.GraphQLString
    },
    forestries_list: {
      type: new _graphql.GraphQLList(forestries_list),
      resolve: leshoz_id => getForestriesList(leshoz_id)
    }
  })
});
const forestries_list = new _graphql.GraphQLObjectType({
  name: "forestries_list",
  fields: () => ({
    gid: {
      type: _graphql.GraphQLString
    },
    geom: {
      type: _graphql.GraphQLString
    },
    forestry_ru: {
      type: _graphql.GraphQLString
    },
    forestry_num: {
      type: _graphql.GraphQLString
    },
    forestrytype_id: {
      type: _graphql.GraphQLString
    },
    block_list: {
      type: new _graphql.GraphQLList(block_list),
      resolve: gid => getBlockList(gid)
    }
  })
});
const block_list = new _graphql.GraphQLObjectType({
  name: "block_list",
  fields: () => ({
    gid: {
      type: _graphql.GraphQLString
    },
    geom: {
      type: _graphql.GraphQLString
    },
    forestry_id: {
      type: _graphql.GraphQLString
    },
    block_num: {
      type: _graphql.GraphQLString
    },
    stand_list: {
      type: new _graphql.GraphQLList(stand_list),
      resolve: gid => getStandList(gid)
    }
  })
});
const stand_list = new _graphql.GraphQLObjectType({
  name: "stand_list",
  fields: () => ({
    gid: {
      type: _graphql.GraphQLString
    },
    geom: {
      type: _graphql.GraphQLString
    },
    leshoz_num: {
      type: _graphql.GraphQLString
    },
    block_num: {
      type: _graphql.GraphQLString
    },
    forestry_num: {
      type: _graphql.GraphQLString
    },
    stand_code: {
      type: _graphql.GraphQLString
    },
    stand_num: {
      type: _graphql.GraphQLString
    }
  })
});
const AllplacesType = new _graphql.GraphQLObjectType({
  name: "Allplaces",
  fields: {
    oblasts: {
      type: new _graphql.GraphQLList(oblast_list),
      resolve: () => getOblastList()
    }
  }
});
exports.AllplacesType = AllplacesType;

const getOblastList = () => {
  return new Promise((resolve, reject) => {
    pool.connect(function (err, client, done) {
      if (err) {
        return console.error('error fetching client from pool', err);
      }

      client.query('SELECT oblast_id, oblast_ru FROM topo.oblast', function (err, result) {
        done();

        if (err) {
          return reject(console.error('error happened during query', err));
        }

        resolve(result.rows);
      });
    });
  });
};

const getLeshozList = gid => {
  return new Promise((resolve, reject) => {
    pool.connect(function (err, client, done) {
      if (err) {
        return console.error('error fetching client from pool', err);
      }

      client.query('SELECT leshoz_id, leshoz_ru, leshoztype_id FROM forest.leshoz WHERE oblast_id =' + gid.oblast_id, function (err, result) {
        done();

        if (err) {
          return reject(console.error('error happened during query', err));
        }

        resolve(result.rows);
      });
    });
  });
};

const getForestriesList = leshoz => {
  return new Promise((resolve, reject) => {
    pool.connect(function (err, client, done) {
      if (err) {
        return console.error('error fetching client from pool', err);
      }

      client.query('SELECT gid, forestry_ru, forestrytype_id, forestry_num FROM forest.forestry WHERE leshoz_id =' + leshoz.leshoz_id, function (err, result) {
        done();

        if (err) {
          return reject(console.error('error happened during query', err));
        }

        resolve(result.rows);
      });
    });
  });
};

const getBlockList = forestry => {
  return new Promise((resolve, reject) => {
    pool.connect(function (err, client, done) {
      if (err) {
        return console.error('error fetching client from pool', err);
      }

      client.query('SELECT gid, block_num, forestry_id FROM forest.block WHERE forestry_id =' + forestry.gid, function (err, result) {
        done();

        if (err) {
          return reject(console.error('error happened during query', err));
        }

        resolve(result.rows);
      });
    });
  });
};

const getStandList = block => {
  return new Promise((resolve, reject) => {
    pool.connect(function (err, client, done) {
      if (err) {
        return console.error('error fetching client from pool', err);
      }

      client.query('SELECT gid, leshoz_num, block_num, forestry_num, stand_num FROM forest.stand WHERE block_id =' + block.gid, function (err, result) {
        done();

        if (err) {
          return reject(console.error('error happened during query', err));
        }

        resolve(result.rows);
      });
    });
  });
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy90eXBlcy9hbGxwbGFjZXMgY29weS5qcyJdLCJuYW1lcyI6WyJjb25TdHJpbmciLCJwb29sIiwiUG9vbCIsImNvbm5lY3Rpb25TdHJpbmciLCJvYmxhc3RfbGlzdCIsIkdyYXBoUUxPYmplY3RUeXBlIiwibmFtZSIsImZpZWxkcyIsIm9ibGFzdF9pZCIsInR5cGUiLCJHcmFwaFFMU3RyaW5nIiwib2JsYXN0X3J1Iiwib2JsYXN0X2t5Iiwib2JsYXN0X2VuIiwiZ2VvbSIsImxlc2hvel9saXN0IiwiR3JhcGhRTExpc3QiLCJyZXNvbHZlIiwiZ2V0TGVzaG96TGlzdCIsImxlc2hvel9pZCIsImxlc2hvel9ydSIsImxlc2hvenR5cGVfaWQiLCJmb3Jlc3RyaWVzX2xpc3QiLCJnZXRGb3Jlc3RyaWVzTGlzdCIsImdpZCIsImZvcmVzdHJ5X3J1IiwiZm9yZXN0cnlfbnVtIiwiZm9yZXN0cnl0eXBlX2lkIiwiYmxvY2tfbGlzdCIsImdldEJsb2NrTGlzdCIsImZvcmVzdHJ5X2lkIiwiYmxvY2tfbnVtIiwic3RhbmRfbGlzdCIsImdldFN0YW5kTGlzdCIsImxlc2hvel9udW0iLCJzdGFuZF9jb2RlIiwic3RhbmRfbnVtIiwiQWxscGxhY2VzVHlwZSIsIm9ibGFzdHMiLCJnZXRPYmxhc3RMaXN0IiwiUHJvbWlzZSIsInJlamVjdCIsImNvbm5lY3QiLCJlcnIiLCJjbGllbnQiLCJkb25lIiwiY29uc29sZSIsImVycm9yIiwicXVlcnkiLCJyZXN1bHQiLCJyb3dzIiwibGVzaG96IiwiZm9yZXN0cnkiLCJibG9jayJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBOztBQUNBOztBQUVBLE1BQU1BLFNBQVMsR0FBRyw4Q0FBbEI7QUFDQSxNQUFNQyxJQUFJLEdBQUcsSUFBSUMsUUFBSixDQUFTO0FBQ3BCQyxFQUFBQSxnQkFBZ0IsRUFBRUg7QUFERSxDQUFULENBQWI7QUFJQSxNQUFNSSxXQUFXLEdBQUcsSUFBSUMsMEJBQUosQ0FBc0I7QUFDeENDLEVBQUFB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OztBQUNEMUIsUUFBQUEsT0FBTyxDQUFDZ0MsTUFBTSxDQUFDQyxJQUFSLENBQVA7QUFDRCxPQU5EO0FBT0QsS0FYRDtBQVlELEdBYk0sQ0FBUDtBQWVELENBaEJEIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgR3JhcGhRTE9iamVjdFR5cGUsIEdyYXBoUUxTdHJpbmcsIEdyYXBoUUxGbG9hdCwgR3JhcGhRTExpc3QgfSBmcm9tIFwiZ3JhcGhxbFwiO1xuaW1wb3J0IHsgUG9vbCB9IGZyb20gJ3BnJ1xuXG5jb25zdCBjb25TdHJpbmcgPSAncG9zdGdyZXM6Ly9wb3N0Z3JlczpAMTkyLjE2OC4yMC43OC9mb3Jlc3RfYmQnXG5jb25zdCBwb29sID0gbmV3IFBvb2woe1xuICBjb25uZWN0aW9uU3RyaW5nOiBjb25TdHJpbmdcbn0pO1xuXG5jb25zdCBvYmxhc3RfbGlzdCA9IG5ldyBHcmFwaFFMT2JqZWN0VHlwZSh7XG4gIG5hbWU6IFwib2JsYXN0X2xpc3RcIixcbiAgZmllbGRzOiAoKSA9PiAoe1xuICAgIG9ibGFzdF9pZDogeyB0eXBlOiBHcmFwaFFMU3RyaW5nIH0sXG4gICAgb2JsYXN0X3J1OiB7IHR5cGU6IEdyYXBoUUxTdHJpbmcgfSxcbiAgICBvYmxhc3Rfa3k6IHsgdHlwZTogR3JhcGhRTFN0cmluZyB9LFxuICAgIG9ibGFzdF9lbjogeyB0eXBlOiBHcmFwaFFMU3RyaW5nIH0sXG4gICAgZ2VvbTogeyB0eXBlOiBHcmFwaFFMU3RyaW5nIH0sXG4gICAgbGVzaG96X2xpc3Q6IHtcbiAgICAgIHR5cGU6IG5ldyBHcmFwaFFMTGlzdChsZXNob3pfbGlzdCksXG4gICAgICByZXNvbHZlOiBvYmxhc3RfaWQgPT4gZ2V0TGVzaG96TGlzdChvYmxhc3RfaWQpXG4gICAgfSxcblxuXG4gIH0pXG59KTtcblxuY29uc3QgbGVzaG96X2xpc3QgPSBuZXcgR3JhcGhRTE9iamVjdFR5cGUoe1xuICBuYW1lOiBcImxlc2hvel9saXN0XCIsXG4gIGZpZWxkczogKCkgPT4gKHtcbiAgICBsZXNob3pfaWQ6IHsgdHlwZTogR3JhcGhRTFN0cmluZyB9LFxuICAgIGxlc2hvel9ydTogeyB0eXBlOiBHcmFwaFFMU3RyaW5nIH0sXG4gICAgZ2VvbTogeyB0eXBlOiBHcmFwaFFMU3RyaW5nIH0sXG4gICAgbGVzaG96dHlwZV9pZDogeyB0eXBlOiBHcmFwaFFMU3RyaW5nIH0sXG4gICAgZm9yZXN0cmllc19saXN0OiB7XG4gICAgICB0eXBlOiBuZXcgR3JhcGhRTExpc3QoZm9yZXN0cmllc19saXN0KSxcbiAgICAgIHJlc29sdmU6IGxlc2hvel9pZCA9PiBnZXRGb3Jlc3RyaWVzTGlzdChsZXNob3pfaWQpXG4gICAgfSxcbiAgfSlcbn0pO1xuXG5jb25zdCBmb3Jlc3RyaWVzX2xpc3QgPSBuZXcgR3JhcGhRTE9iamVjdFR5cGUoe1xuICBuYW1lOiBcImZvcmVzdHJpZXNfbGlzdFwiLFxuICBmaWVsZHM6ICgpID0+ICh7XG4gICAgZ2lkOiB7IHR5cGU6IEdyYXBoUUxTdHJpbmcgfSxcbiAgICBnZW9tOiB7IHR5cGU6IEdyYXBoUUxTdHJpbmcgfSxcbiAgICBmb3Jlc3RyeV9ydTogeyB0eXBlOiBHcmFwaFFMU3RyaW5nIH0sXG4gICAgZm9yZXN0cnlfbnVtOiB7IHR5cGU6IEdyYXBoUUxTdHJpbmcgfSxcbiAgICBmb3Jlc3RyeXR5cGVfaWQ6IHsgdHlwZTogR3JhcGhRTFN0cmluZyB9LFxuICAgIGJsb2NrX2xpc3Q6IHtcbiAgICAgIHR5cGU6IG5ldyBHcmFwaFFMTGlzdChibG9ja19saXN0KSxcbiAgICAgIHJlc29sdmU6IGdpZCA9PiBnZXRCbG9ja0xpc3QoZ2lkKVxuICAgIH0sXG4gIH0pXG59KTtcblxuY29uc3QgYmxvY2tfbGlzdCA9IG5ldyBHcmFwaFFMT2JqZWN0VHlwZSh7XG4gIG5hbWU6IFwiYmxvY2tfbGlzdFwiLFxuICBmaWVsZHM6ICgpID0+ICh7XG4gICAgZ2lkOiB7IHR5cGU6IEdyYXBoUUxTdHJpbmcgfSxcbiAgICBnZW9tOiB7IHR5cGU6IEdyYXBoUUxTdHJpbmcgfSxcbiAgICBmb3Jlc3RyeV9pZDogeyB0eXBlOiBHcmFwaFFMU3RyaW5nIH0sXG4gICAgYmxvY2tfbnVtOiB7IHR5cGU6IEdyYXBoUUxTdHJpbmcgfSxcbiAgICBzdGFuZF9saXN0OiB7XG4gICAgICB0eXBlOiBuZXcgR3JhcGhRTExpc3Qoc3RhbmRfbGlzdCksXG4gICAgICByZXNvbHZlOiBnaWQgPT4gZ2V0U3RhbmRMaXN0KGdpZClcbiAgICB9LFxuICB9KVxufSk7XG5cbmNvbnN0IHN0YW5kX2xpc3QgPSBuZXcgR3JhcGhRTE9iamVjdFR5cGUoe1xuICBuYW1lOiBcInN0YW5kX2xpc3RcIixcbiAgZmllbGRzOiAoKSA9PiAoe1xuICAgIGdpZDogeyB0eXBlOiBHcmFwaFFMU3RyaW5nIH0sXG4gICAgZ2VvbTogeyB0eXBlOiBHcmFwaFFMU3RyaW5nIH0sXG4gICAgbGVzaG96X251bTogeyB0eXBlOiBHcmFwaFFMU3RyaW5nIH0sXG4gICAgYmxvY2tfbnVtOiB7IHR5cGU6IEdyYXBoUUxTdHJpbmcgfSxcbiAgICBmb3Jlc3RyeV9udW06IHsgdHlwZTogR3JhcGhRTFN0cmluZyB9LFxuICAgIHN0YW5kX2NvZGU6IHsgdHlwZTogR3JhcGhRTFN0cmluZyB9LFxuICAgIHN0YW5kX251bTogeyB0eXBlOiBHcmFwaFFMU3RyaW5nIH0sXG4gIH0pXG59KTtcblxuXG5leHBvcnQgY29uc3QgQWxscGxhY2VzVHlwZSA9IG5ldyBHcmFwaFFMT2JqZWN0VHlwZSh7XG4gIG5hbWU6IFwiQWxscGxhY2VzXCIsXG4gIGZpZWxkczoge1xuICAgIG9ibGFzdHM6IHtcbiAgICAgIHR5cGU6IG5ldyBHcmFwaFFMTGlzdChvYmxhc3RfbGlzdCksXG4gICAgICByZXNvbHZlOiAoKSA9PiBnZXRPYmxhc3RMaXN0KClcbiAgICB9XG4gIH1cbn0pO1xuXG5cbmNvbnN0IGdldE9ibGFzdExpc3QgPSAoKSA9PiB7XG4gIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgcG9vbC5jb25uZWN0KGZ1bmN0aW9uIChlcnIsIGNsaWVudCwgZG9uZSkge1xuICAgICAgaWYgKGVycikge1xuICAgICAgICByZXR1cm4gY29uc29sZS5lcnJvcignZXJyb3IgZmV0Y2hpbmcgY2xpZW50IGZyb20gcG9vbCcsIGVycilcbiAgICAgIH1cbiAgICAgIGNsaWVudC5xdWVyeSgnU0VMRUNUIG9ibGFzdF9pZCwgb2JsYXN0X3J1IEZST00gdG9wby5vYmxhc3QnLCBmdW5jdGlvbiAoZXJyLCByZXN1bHQpIHtcbiAgICAgICAgZG9uZSgpXG4gICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICByZXR1cm4gcmVqZWN0KGNvbnNvbGUuZXJyb3IoJ2Vycm9yIGhhcHBlbmVkIGR1cmluZyBxdWVyeScsIGVycikpXG4gICAgICAgIH1cbiAgICAgICAgcmVzb2x2ZShyZXN1bHQucm93cylcbiAgICAgIH0pXG4gICAgfSlcbiAgfVxuICApXG59XG5cbmNvbnN0IGdldExlc2hvekxpc3QgPSAoZ2lkKSA9PiB7XG4gIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgcG9vbC5jb25uZWN0KGZ1bmN0aW9uIChlcnIsIGNsaWVudCwgZG9uZSkge1xuICAgICAgaWYgKGVycikge1xuICAgICAgICByZXR1cm4gY29uc29sZS5lcnJvcignZXJyb3IgZmV0Y2hpbmcgY2xpZW50IGZyb20gcG9vbCcsIGVycilcbiAgICAgIH1cbiAgICAgIGNsaWVudC5xdWVyeSgnU0VMRUNUIGxlc2hvel9pZCwgbGVzaG96X3J1LCBsZXNob3p0eXBlX2lkIEZST00gZm9yZXN0Lmxlc2hveiBXSEVSRSBvYmxhc3RfaWQgPScgKyBnaWQub2JsYXN0X2lkLCBmdW5jdGlvbiAoZXJyLCByZXN1bHQpIHtcbiAgICAgICAgZG9uZSgpXG4gICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICByZXR1cm4gcmVqZWN0KGNvbnNvbGUuZXJyb3IoJ2Vycm9yIGhhcHBlbmVkIGR1cmluZyBxdWVyeScsIGVycikpXG4gICAgICAgIH1cbiAgICAgICAgcmVzb2x2ZShyZXN1bHQucm93cylcbiAgICAgIH0pXG4gICAgfSlcbiAgfVxuICApXG59XG5cbmNvbnN0IGdldEZvcmVzdHJpZXNMaXN0ID0gKGxlc2hveikgPT4ge1xuICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgIHBvb2wuY29ubmVjdChmdW5jdGlvbiAoZXJyLCBjbGllbnQsIGRvbmUpIHtcbiAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgcmV0dXJuIGNvbnNvbGUuZXJyb3IoJ2Vycm9yIGZldGNoaW5nIGNsaWVudCBmcm9tIHBvb2wnLCBlcnIpXG4gICAgICB9XG4gICAgICBjbGllbnQucXVlcnkoJ1NFTEVDVCBnaWQsIGZvcmVzdHJ5X3J1LCBmb3Jlc3RyeXR5cGVfaWQsIGZvcmVzdHJ5X251bSBGUk9NIGZvcmVzdC5mb3Jlc3RyeSBXSEVSRSBsZXNob3pfaWQgPScgKyBsZXNob3oubGVzaG96X2lkLCBmdW5jdGlvbiAoZXJyLCByZXN1bHQpIHtcbiAgICAgICAgZG9uZSgpXG4gICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICByZXR1cm4gcmVqZWN0KGNvbnNvbGUuZXJyb3IoJ2Vycm9yIGhhcHBlbmVkIGR1cmluZyBxdWVyeScsIGVycikpXG4gICAgICAgIH1cbiAgICAgICAgcmVzb2x2ZShyZXN1bHQucm93cylcbiAgICAgIH0pXG4gICAgfSlcbiAgfVxuICApXG59XG5cblxuY29uc3QgZ2V0QmxvY2tMaXN0ID0gKGZvcmVzdHJ5KSA9PiB7XG4gIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgcG9vbC5jb25uZWN0KGZ1bmN0aW9uIChlcnIsIGNsaWVudCwgZG9uZSkge1xuICAgICAgaWYgKGVycikge1xuICAgICAgICByZXR1cm4gY29uc29sZS5lcnJvcignZXJyb3IgZmV0Y2hpbmcgY2xpZW50IGZyb20gcG9vbCcsIGVycilcbiAgICAgIH1cbiAgICAgIGNsaWVudC5xdWVyeSgnU0VMRUNUIGdpZCwgYmxvY2tfbnVtLCBmb3Jlc3RyeV9pZCBGUk9NIGZvcmVzdC5ibG9jayBXSEVSRSBmb3Jlc3RyeV9pZCA9JyArIGZvcmVzdHJ5LmdpZCwgZnVuY3Rpb24gKGVyciwgcmVzdWx0KSB7XG4gICAgICAgIGRvbmUoKVxuICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgcmV0dXJuIHJlamVjdChjb25zb2xlLmVycm9yKCdlcnJvciBoYXBwZW5lZCBkdXJpbmcgcXVlcnknLCBlcnIpKVxuICAgICAgICB9XG4gICAgICAgIHJlc29sdmUocmVzdWx0LnJvd3MpXG4gICAgICB9KVxuICAgIH0pXG4gIH1cbiAgKVxufVxuXG5cbmNvbnN0IGdldFN0YW5kTGlzdCA9IChibG9jaykgPT4ge1xuICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgIHBvb2wuY29ubmVjdChmdW5jdGlvbiAoZXJyLCBjbGllbnQsIGRvbmUpIHtcbiAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgcmV0dXJuIGNvbnNvbGUuZXJyb3IoJ2Vycm9yIGZldGNoaW5nIGNsaWVudCBmcm9tIHBvb2wnLCBlcnIpXG4gICAgICB9XG4gICAgICBjbGllbnQucXVlcnkoJ1NFTEVDVCBnaWQsIGxlc2hvel9udW0sIGJsb2NrX251bSwgZm9yZXN0cnlfbnVtLCBzdGFuZF9udW0gRlJPTSBmb3Jlc3Quc3RhbmQgV0hFUkUgYmxvY2tfaWQgPScgKyBibG9jay5naWQsIGZ1bmN0aW9uIChlcnIsIHJlc3VsdCkge1xuICAgICAgICBkb25lKClcbiAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgIHJldHVybiByZWplY3QoY29uc29sZS5lcnJvcignZXJyb3IgaGFwcGVuZWQgZHVyaW5nIHF1ZXJ5JywgZXJyKSlcbiAgICAgICAgfVxuICAgICAgICByZXNvbHZlKHJlc3VsdC5yb3dzKVxuICAgICAgfSlcbiAgICB9KVxuICB9XG4gIClcbn0iXX0=