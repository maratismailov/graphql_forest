"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.AllplacesType = void 0;

var _graphql = require("graphql");

var _pg = require("pg");

const conString = 'postgres://postgres:@192.168.20.78/forest_bd';
const pool = new _pg.Pool({
  connectionString: conString
});
const oblast_list = new _graphql.GraphQLObjectType({
  name: "oblast_list",
  fields: () => ({
    oblast_id: {
      type: _graphql.GraphQLString
    },
    oblast_ru: {
      type: _graphql.GraphQLString
    },
    oblast_ky: {
      type: _graphql.GraphQLString
    },
    oblast_en: {
      type: _graphql.GraphQLString
    },
    st_asewkt: {
      type: _graphql.GraphQLString
    },
    leshoz_list: {
      type: new _graphql.GraphQLList(leshoz_list),
      resolve: oblast_id => getLeshozList(oblast_id)
    }
  })
});
const leshoz_list = new _graphql.GraphQLObjectType({
  name: "leshoz_list",
  fields: () => ({
    leshoz_id: {
      type: _graphql.GraphQLString
    },
    leshoz_ru: {
      type: _graphql.GraphQLString
    },
    geom: {
      type: _graphql.GraphQLString
    },
    leshoztype_id: {
      type: _graphql.GraphQLString
    },
    forestries_list: {
      type: new _graphql.GraphQLList(forestries_list),
      resolve: leshoz_id => getForestriesList(leshoz_id)
    }
  })
});
const forestries_list = new _graphql.GraphQLObjectType({
  name: "forestries_list",
  fields: () => ({
    gid: {
      type: _graphql.GraphQLString
    },
    the_geom: {
      type: _graphql.GraphQLString
    },
    forestry_ru: {
      type: _graphql.GraphQLString
    },
    forestry_num: {
      type: _graphql.GraphQLString
    },
    forestrytype_id: {
      type: _graphql.GraphQLString
    },
    block_list: {
      type: new _graphql.GraphQLList(block_list),
      resolve: gid => getBlockList(gid)
    }
  })
});
const block_list = new _graphql.GraphQLObjectType({
  name: "block_list",
  fields: () => ({
    gid: {
      type: _graphql.GraphQLString
    },
    the_geom: {
      type: _graphql.GraphQLString
    },
    forestry_id: {
      type: _graphql.GraphQLString
    },
    block_num: {
      type: _graphql.GraphQLString
    },
    stand_list: {
      type: new _graphql.GraphQLList(stand_list),
      resolve: gid => getStandList(gid)
    }
  })
});
const stand_list = new _graphql.GraphQLObjectType({
  name: "stand_list",
  fields: () => ({
    gid: {
      type: _graphql.GraphQLString
    },
    the_geom: {
      type: _graphql.GraphQLString
    },
    leshoz_num: {
      type: _graphql.GraphQLString
    },
    block_num: {
      type: _graphql.GraphQLString
    },
    forestry_num: {
      type: _graphql.GraphQLString
    },
    stand_code: {
      type: _graphql.GraphQLString
    }
  })
});
const AllplacesType = new _graphql.GraphQLObjectType({
  name: "Allplaces",
  fields: {
    oblasts: {
      type: new _graphql.GraphQLList(oblast_list),
      resolve: () => getOblastList()
    }
  }
});
exports.AllplacesType = AllplacesType;

const getOblastList = () => {
  return new Promise((resolve, reject) => {
    pool.connect(function (err, client, done) {
      if (err) {
        return console.error('error fetching client from pool', err);
      }

      client.query('SELECT oblast_id, ST_AsEWKT(the_geom), oblast_ru FROM topo.oblast', function (err, result) {
        done();

        if (err) {
          return reject(console.error('error happened during query', err));
        }

        resolve(result.rows);
      });
    });
  });
};

const getLeshozList = gid => {
  return new Promise((resolve, reject) => {
    pool.connect(function (err, client, done) {
      if (err) {
        return console.error('error fetching client from pool', err);
      }

      client.query('SELECT * FROM forest.leshoz WHERE oblast_id =' + gid.oblast_id, function (err, result) {
        done();

        if (err) {
          return reject(console.error('error happened during query', err));
        }

        resolve(result.rows);
      });
    });
  });
};

const getForestriesList = leshoz => {
  return new Promise((resolve, reject) => {
    pool.connect(function (err, client, done) {
      if (err) {
        return console.error('error fetching client from pool', err);
      }

      client.query('SELECT * FROM forest.forestry WHERE leshoz_id =' + leshoz.leshoz_id, function (err, result) {
        done();

        if (err) {
          return reject(console.error('error happened during query', err));
        }

        resolve(result.rows);
      });
    });
  });
};

const getBlockList = forestry => {
  return new Promise((resolve, reject) => {
    pool.connect(function (err, client, done) {
      if (err) {
        return console.error('error fetching client from pool', err);
      }

      client.query('SELECT * FROM forest.block WHERE forestry_id =' + forestry.gid, function (err, result) {
        done();

        if (err) {
          return reject(console.error('error happened during query', err));
        }

        resolve(result.rows);
      });
    });
  });
};

const getStandList = block => {
  return new Promise((resolve, reject) => {
    pool.connect(function (err, client, done) {
      if (err) {
        return console.error('error fetching client from pool', err);
      }

      client.query('SELECT * FROM forest.stand WHERE block_id =' + block.gid, function (err, result) {
        done();

        if (err) {
          return reject(console.error('error happened during query', err));
        }

        resolve(result.rows);
      });
    });
  });
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy90eXBlcy9hbGxwbGFjZXMuanMiXSwibmFtZXMiOlsiY29uU3RyaW5nIiwicG9vbCIsIlBvb2wiLCJjb25uZWN0aW9uU3RyaW5nIiwib2JsYXN0X2xpc3QiLCJHcmFwaFFMT2JqZWN0VHlwZSIsIm5hbWUiLCJmaWVsZHMiLCJvYmxhc3RfaWQiLCJ0eXBlIiwiR3JhcGhRTFN0cmluZyIsIm9ibGFzdF9ydSIsIm9ibGFzdF9reSIsIm9ibGFzdF9lbiIsInN0X2FzZXdrdCIsImxlc2hvel9saXN0IiwiR3JhcGhRTExpc3QiLCJyZXNvbHZlIiwiZ2V0TGVzaG96TGlzdCIsImxlc2hvel9pZCIsImxlc2hvel9ydSIsImdlb20iLCJsZXNob3p0eXBlX2lkIiwiZm9yZXN0cmllc19saXN0IiwiZ2V0Rm9yZXN0cmllc0xpc3QiLCJnaWQiLCJ0aGVfZ2VvbSIsImZvcmVzdHJ5X3J1IiwiZm9yZXN0cnlfbnVtIiwiZm9yZXN0cnl0eXBlX2lkIiwiYmxvY2tfbGlzdCIsImdldEJsb2NrTGlzdCIsImZvcmVzdHJ5X2lkIiwiYmxvY2tfbnVtIiwic3RhbmRfbGlzdCIsImdldFN0YW5kTGlzdCIsImxlc2hvel9udW0iLCJzdGFuZF9jb2RlIiwiQWxscGxhY2VzVHlwZSIsIm9ibGFzdHMiLCJnZXRPYmxhc3RMaXN0IiwiUHJvbWlzZSIsInJlamVjdCIsImNvbm5lY3QiLCJlcnIiLCJjbGllbnQiLCJkb25lIiwiY29uc29sZSIsImVycm9yIiwicXVlcnkiLCJyZXN1bHQiLCJyb3dzIiwibGVzaG96IiwiZm9yZXN0cnkiLCJibG9jayJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBOztBQUNBOztBQUVBLE1BQU1BLFNBQVMsR0FBRyw4Q0FBbEI7QUFDQSxNQUFNQyxJQUFJLEdBQUcsSUFBSUMsUUFBSixDQUFTO0FBQ3BCQyxFQUFBQSxnQkFBZ0IsRUFBRUg7QUFERSxDQUFULENBQWI7QUFJQSxNQUFNSSxXQUFXLEdBQUcsSUFBSUMsMEJBQUosQ0FBc0I7QUFDeEND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QVIsQ0FBUDtBQUNELE9BTkQ7QUFPRCxLQVhEO0FBWUQsR0FiTSxDQUFQO0FBZUQsQ0FoQkQiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBHcmFwaFFMT2JqZWN0VHlwZSwgR3JhcGhRTFN0cmluZywgR3JhcGhRTEZsb2F0LCBHcmFwaFFMTGlzdCB9IGZyb20gXCJncmFwaHFsXCI7XG5pbXBvcnQgeyBQb29sIH0gZnJvbSAncGcnXG5cbmNvbnN0IGNvblN0cmluZyA9ICdwb3N0Z3JlczovL3Bvc3RncmVzOkAxOTIuMTY4LjIwLjc4L2ZvcmVzdF9iZCdcbmNvbnN0IHBvb2wgPSBuZXcgUG9vbCh7XG4gIGNvbm5lY3Rpb25TdHJpbmc6IGNvblN0cmluZ1xufSk7XG5cbmNvbnN0IG9ibGFzdF9saXN0ID0gbmV3IEdyYXBoUUxPYmplY3RUeXBlKHtcbiAgbmFtZTogXCJvYmxhc3RfbGlzdFwiLFxuICBmaWVsZHM6ICgpID0+ICh7XG4gICAgb2JsYXN0X2lkOiB7IHR5cGU6IEdyYXBoUUxTdHJpbmcgfSxcbiAgICBvYmxhc3RfcnU6IHsgdHlwZTogR3JhcGhRTFN0cmluZyB9LFxuICAgIG9ibGFzdF9reTogeyB0eXBlOiBHcmFwaFFMU3RyaW5nIH0sXG4gICAgb2JsYXN0X2VuOiB7IHR5cGU6IEdyYXBoUUxTdHJpbmcgfSxcbiAgICBzdF9hc2V3a3Q6IHsgdHlwZTogR3JhcGhRTFN0cmluZyB9LFxuICAgIGxlc2hvel9saXN0OiB7XG4gICAgICB0eXBlOiBuZXcgR3JhcGhRTExpc3QobGVzaG96X2xpc3QpLFxuICAgICAgcmVzb2x2ZTogb2JsYXN0X2lkID0+IGdldExlc2hvekxpc3Qob2JsYXN0X2lkKVxuICAgIH0sXG5cblxuICB9KVxufSk7XG5cbmNvbnN0IGxlc2hvel9saXN0ID0gbmV3IEdyYXBoUUxPYmplY3RUeXBlKHtcbiAgbmFtZTogXCJsZXNob3pfbGlzdFwiLFxuICBmaWVsZHM6ICgpID0+ICh7XG4gICAgbGVzaG96X2lkOiB7IHR5cGU6IEdyYXBoUUxTdHJpbmcgfSxcbiAgICBsZXNob3pfcnU6IHsgdHlwZTogR3JhcGhRTFN0cmluZyB9LFxuICAgIGdlb206IHsgdHlwZTogR3JhcGhRTFN0cmluZyB9LFxuICAgIGxlc2hvenR5cGVfaWQ6IHsgdHlwZTogR3JhcGhRTFN0cmluZyB9LFxuICAgIGZvcmVzdHJpZXNfbGlzdDoge1xuICAgICAgdHlwZTogbmV3IEdyYXBoUUxMaXN0KGZvcmVzdHJpZXNfbGlzdCksXG4gICAgICByZXNvbHZlOiBsZXNob3pfaWQgPT4gZ2V0Rm9yZXN0cmllc0xpc3QobGVzaG96X2lkKVxuICAgIH0sXG4gIH0pXG59KTtcblxuY29uc3QgZm9yZXN0cmllc19saXN0ID0gbmV3IEdyYXBoUUxPYmplY3RUeXBlKHtcbiAgbmFtZTogXCJmb3Jlc3RyaWVzX2xpc3RcIixcbiAgZmllbGRzOiAoKSA9PiAoe1xuICAgIGdpZDogeyB0eXBlOiBHcmFwaFFMU3RyaW5nIH0sXG4gICAgdGhlX2dlb206IHsgdHlwZTogR3JhcGhRTFN0cmluZyB9LFxuICAgIGZvcmVzdHJ5X3J1OiB7IHR5cGU6IEdyYXBoUUxTdHJpbmcgfSxcbiAgICBmb3Jlc3RyeV9udW06IHsgdHlwZTogR3JhcGhRTFN0cmluZyB9LFxuICAgIGZvcmVzdHJ5dHlwZV9pZDogeyB0eXBlOiBHcmFwaFFMU3RyaW5nIH0sXG4gICAgYmxvY2tfbGlzdDoge1xuICAgICAgdHlwZTogbmV3IEdyYXBoUUxMaXN0KGJsb2NrX2xpc3QpLFxuICAgICAgcmVzb2x2ZTogZ2lkID0+IGdldEJsb2NrTGlzdChnaWQpXG4gICAgfSxcbiAgfSlcbn0pO1xuXG5jb25zdCBibG9ja19saXN0ID0gbmV3IEdyYXBoUUxPYmplY3RUeXBlKHtcbiAgbmFtZTogXCJibG9ja19saXN0XCIsXG4gIGZpZWxkczogKCkgPT4gKHtcbiAgICBnaWQ6IHsgdHlwZTogR3JhcGhRTFN0cmluZyB9LFxuICAgIHRoZV9nZW9tOiB7IHR5cGU6IEdyYXBoUUxTdHJpbmcgfSxcbiAgICBmb3Jlc3RyeV9pZDogeyB0eXBlOiBHcmFwaFFMU3RyaW5nIH0sXG4gICAgYmxvY2tfbnVtOiB7IHR5cGU6IEdyYXBoUUxTdHJpbmcgfSxcbiAgICBzdGFuZF9saXN0OiB7XG4gICAgICB0eXBlOiBuZXcgR3JhcGhRTExpc3Qoc3RhbmRfbGlzdCksXG4gICAgICByZXNvbHZlOiBnaWQgPT4gZ2V0U3RhbmRMaXN0KGdpZClcbiAgICB9LFxuICB9KVxufSk7XG5cbmNvbnN0IHN0YW5kX2xpc3QgPSBuZXcgR3JhcGhRTE9iamVjdFR5cGUoe1xuICBuYW1lOiBcInN0YW5kX2xpc3RcIixcbiAgZmllbGRzOiAoKSA9PiAoe1xuICAgIGdpZDogeyB0eXBlOiBHcmFwaFFMU3RyaW5nIH0sXG4gICAgdGhlX2dlb206IHsgdHlwZTogR3JhcGhRTFN0cmluZyB9LFxuICAgIGxlc2hvel9udW06IHsgdHlwZTogR3JhcGhRTFN0cmluZyB9LFxuICAgIGJsb2NrX251bTogeyB0eXBlOiBHcmFwaFFMU3RyaW5nIH0sXG4gICAgZm9yZXN0cnlfbnVtOiB7IHR5cGU6IEdyYXBoUUxTdHJpbmcgfSxcbiAgICBzdGFuZF9jb2RlOiB7IHR5cGU6IEdyYXBoUUxTdHJpbmcgfSxcbiAgfSlcbn0pO1xuXG5cbmV4cG9ydCBjb25zdCBBbGxwbGFjZXNUeXBlID0gbmV3IEdyYXBoUUxPYmplY3RUeXBlKHtcbiAgbmFtZTogXCJBbGxwbGFjZXNcIixcbiAgZmllbGRzOiB7XG4gICAgb2JsYXN0czoge1xuICAgICAgdHlwZTogbmV3IEdyYXBoUUxMaXN0KG9ibGFzdF9saXN0KSxcbiAgICAgIHJlc29sdmU6ICgpID0+IGdldE9ibGFzdExpc3QoKVxuICAgIH1cbiAgfVxufSk7XG5cblxuY29uc3QgZ2V0T2JsYXN0TGlzdCA9ICgpID0+IHtcbiAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICBwb29sLmNvbm5lY3QoZnVuY3Rpb24gKGVyciwgY2xpZW50LCBkb25lKSB7XG4gICAgICBpZiAoZXJyKSB7XG4gICAgICAgIHJldHVybiBjb25zb2xlLmVycm9yKCdlcnJvciBmZXRjaGluZyBjbGllbnQgZnJvbSBwb29sJywgZXJyKVxuICAgICAgfVxuICAgICAgY2xpZW50LnF1ZXJ5KCdTRUxFQ1Qgb2JsYXN0X2lkLCBTVF9Bc0VXS1QodGhlX2dlb20pLCBvYmxhc3RfcnUgRlJPTSB0b3BvLm9ibGFzdCcsIGZ1bmN0aW9uIChlcnIsIHJlc3VsdCkge1xuICAgICAgICBkb25lKClcbiAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgIHJldHVybiByZWplY3QoY29uc29sZS5lcnJvcignZXJyb3IgaGFwcGVuZWQgZHVyaW5nIHF1ZXJ5JywgZXJyKSlcbiAgICAgICAgfVxuICAgICAgICByZXNvbHZlKHJlc3VsdC5yb3dzKVxuICAgICAgfSlcbiAgICB9KVxuICB9XG4gIClcbn1cblxuY29uc3QgZ2V0TGVzaG96TGlzdCA9IChnaWQpID0+IHtcbiAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICBwb29sLmNvbm5lY3QoZnVuY3Rpb24gKGVyciwgY2xpZW50LCBkb25lKSB7XG4gICAgICBpZiAoZXJyKSB7XG4gICAgICAgIHJldHVybiBjb25zb2xlLmVycm9yKCdlcnJvciBmZXRjaGluZyBjbGllbnQgZnJvbSBwb29sJywgZXJyKVxuICAgICAgfVxuICAgICAgY2xpZW50LnF1ZXJ5KCdTRUxFQ1QgKiBGUk9NIGZvcmVzdC5sZXNob3ogV0hFUkUgb2JsYXN0X2lkID0nICsgZ2lkLm9ibGFzdF9pZCwgZnVuY3Rpb24gKGVyciwgcmVzdWx0KSB7XG4gICAgICAgIGRvbmUoKVxuICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgcmV0dXJuIHJlamVjdChjb25zb2xlLmVycm9yKCdlcnJvciBoYXBwZW5lZCBkdXJpbmcgcXVlcnknLCBlcnIpKVxuICAgICAgICB9XG4gICAgICAgIHJlc29sdmUocmVzdWx0LnJvd3MpXG4gICAgICB9KVxuICAgIH0pXG4gIH1cbiAgKVxufVxuXG5jb25zdCBnZXRGb3Jlc3RyaWVzTGlzdCA9IChsZXNob3opID0+IHtcbiAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICBwb29sLmNvbm5lY3QoZnVuY3Rpb24gKGVyciwgY2xpZW50LCBkb25lKSB7XG4gICAgICBpZiAoZXJyKSB7XG4gICAgICAgIHJldHVybiBjb25zb2xlLmVycm9yKCdlcnJvciBmZXRjaGluZyBjbGllbnQgZnJvbSBwb29sJywgZXJyKVxuICAgICAgfVxuICAgICAgY2xpZW50LnF1ZXJ5KCdTRUxFQ1QgKiBGUk9NIGZvcmVzdC5mb3Jlc3RyeSBXSEVSRSBsZXNob3pfaWQgPScgKyBsZXNob3oubGVzaG96X2lkLCBmdW5jdGlvbiAoZXJyLCByZXN1bHQpIHtcbiAgICAgICAgZG9uZSgpXG4gICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICByZXR1cm4gcmVqZWN0KGNvbnNvbGUuZXJyb3IoJ2Vycm9yIGhhcHBlbmVkIGR1cmluZyBxdWVyeScsIGVycikpXG4gICAgICAgIH1cbiAgICAgICAgcmVzb2x2ZShyZXN1bHQucm93cylcbiAgICAgIH0pXG4gICAgfSlcbiAgfVxuICApXG59XG5cblxuY29uc3QgZ2V0QmxvY2tMaXN0ID0gKGZvcmVzdHJ5KSA9PiB7XG4gIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgcG9vbC5jb25uZWN0KGZ1bmN0aW9uIChlcnIsIGNsaWVudCwgZG9uZSkge1xuICAgICAgaWYgKGVycikge1xuICAgICAgICByZXR1cm4gY29uc29sZS5lcnJvcignZXJyb3IgZmV0Y2hpbmcgY2xpZW50IGZyb20gcG9vbCcsIGVycilcbiAgICAgIH1cbiAgICAgIGNsaWVudC5xdWVyeSgnU0VMRUNUICogRlJPTSBmb3Jlc3QuYmxvY2sgV0hFUkUgZm9yZXN0cnlfaWQgPScgKyBmb3Jlc3RyeS5naWQsIGZ1bmN0aW9uIChlcnIsIHJlc3VsdCkge1xuICAgICAgICBkb25lKClcbiAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgIHJldHVybiByZWplY3QoY29uc29sZS5lcnJvcignZXJyb3IgaGFwcGVuZWQgZHVyaW5nIHF1ZXJ5JywgZXJyKSlcbiAgICAgICAgfVxuICAgICAgICByZXNvbHZlKHJlc3VsdC5yb3dzKVxuICAgICAgfSlcbiAgICB9KVxuICB9XG4gIClcbn1cblxuXG5jb25zdCBnZXRTdGFuZExpc3QgPSAoYmxvY2spID0+IHtcbiAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICBwb29sLmNvbm5lY3QoZnVuY3Rpb24gKGVyciwgY2xpZW50LCBkb25lKSB7XG4gICAgICBpZiAoZXJyKSB7XG4gICAgICAgIHJldHVybiBjb25zb2xlLmVycm9yKCdlcnJvciBmZXRjaGluZyBjbGllbnQgZnJvbSBwb29sJywgZXJyKVxuICAgICAgfVxuICAgICAgY2xpZW50LnF1ZXJ5KCdTRUxFQ1QgKiBGUk9NIGZvcmVzdC5zdGFuZCBXSEVSRSBibG9ja19pZCA9JyArIGJsb2NrLmdpZCwgZnVuY3Rpb24gKGVyciwgcmVzdWx0KSB7XG4gICAgICAgIGRvbmUoKVxuICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgcmV0dXJuIHJlamVjdChjb25zb2xlLmVycm9yKCdlcnJvciBoYXBwZW5lZCBkdXJpbmcgcXVlcnknLCBlcnIpKVxuICAgICAgICB9XG4gICAgICAgIHJlc29sdmUocmVzdWx0LnJvd3MpXG4gICAgICB9KVxuICAgIH0pXG4gIH1cbiAgKVxufVxuIl19